timestamp: 2025-04-12T20:46:57Z # Updated timestamp
services:
  #BRIDGE_SERVER: &{
    name: BridgeServer,
    ^critical,
    endpoints: [
      {
        path: ws://localhost:9901,
        method: WebSocket,
        description: "Receives and broadcasts highlight commands"
      }
    ],
    messageSchema: {
      type: "HIGHLIGHT_COMPONENT",
      component: "string"
    },
    >relays: [#EXT_BG, #VSC_CLIENT],
    pattern: WebSocketServer,
    tests: [
      {scenario: "Valid message", result: "Broadcasts to all clients"},
      {scenario: "Malformed message", result: "Logs and ignores"}
    ]
  }

  #EXT_BG: &{
    name: BackgroundScriptService,
    endpoints: [
      {
        path: ws://localhost:9901,
        method: WebSocket,
        description: "Connects to bridge server, receives highlight commands"
      }
    ],
    >relays: [HighlightCommand to #EXT_CONTENT],
    pattern: WebSocketRelay,
    tests: [
      {scenario: "Receives command", result: "Relays to content script"}
    ]
  }

  #VSC_CLIENT: &{
    name: VSCodeWebSocketClientService,
    endpoints: [
      {
        path: ws://localhost:9901,
        method: WebSocket,
        description: "Sends highlight command to bridge server"
      }
    ],
    >sends: [HighlightCommand],
    pattern: WebSocketClient,
    tests: [
      {scenario: "Send command", result: "Message sent to server"}
    ]
  }
